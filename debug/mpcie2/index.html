
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="http://pcengines.github.io/apu2-documentation/debug/mpcie2/">
      
      
        <link rel="prev" href="../mpcie1_mpcie2_ethernet_card/">
      
      
        <link rel="next" href="../openwrt/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.5">
    
    
      
        <title>Mpcie2 - apu2 Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.558e4712.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#asm1061-in-the-j13-slot-problems" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="apu2 Documentation" class="md-header__button md-logo" aria-label="apu2 Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            apu2 Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Mpcie2
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="apu2 Documentation" class="md-nav__button md-logo" aria-label="apu2 Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    apu2 Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../apu_CPU_boost/" class="md-nav__link">
        apu CPU boost
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../apu_ecc/" class="md-nav__link">
        Apu ecc
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../apu_flashing_ipxe/" class="md-nav__link">
        Apu flashing ipxe
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../apu_flashing_with_rpi/" class="md-nav__link">
        Apu flashing with rpi
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../APU_mPCIe_capabilities/" class="md-nav__link">
        APU mPCIe capabilities
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../apu2_vboot/" class="md-nav__link">
        Apu2 vboot
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../apu2_vs_apu3/" class="md-nav__link">
        Apu2 vs apu3
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../apu2_vs_apu4/" class="md-nav__link">
        Apu2 vs apu4
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../cbmem_building/" class="md-nav__link">
        Cbmem building
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../cold_reset/" class="md-nav__link">
        Performing cold reset remotely
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../firmware_flashing/" class="md-nav__link">
        Firmware flashing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../flashrom_building/" class="md-nav__link">
        Flashrom building
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../generating_coreboot_support_logs/" class="md-nav__link">
        Generating coreboot support logs
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../gpios/" class="md-nav__link">
        Gpios
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../ipxe_compile/" class="md-nav__link">
        Ipxe compile
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../linux_issues/" class="md-nav__link">
        Linux issues
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../microcode_patching/" class="md-nav__link">
        Microcode patching
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../mpcie_modules/" class="md-nav__link">
        Mpcie modules
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../order_of_PCI_addresses/" class="md-nav__link">
        order of PCI addresses
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../os_boot_serial_console/" class="md-nav__link">
        Os boot serial console
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../os-status/" class="md-nav__link">
        Os status
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../pfsense_installerconfig/" class="md-nav__link">
        Pfsense installerconfig
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../pfSense-install-guide/" class="md-nav__link">
        pfSense install guide
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../pxelinux-cfg/" class="md-nav__link">
        Pxelinux cfg
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../release_process/" class="md-nav__link">
        Release process
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../sd_card_performance_test/" class="md-nav__link">
        Sd card performance test
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../serial_console/" class="md-nav__link">
        Serial console
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../supported_coreboot_build/" class="md-nav__link">
        Supported coreboot build
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../theory-of-operation/" class="md-nav__link">
        apu features - theory of operation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../tianocore_build/" class="md-nav__link">
        Tianocore build
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../tpm_menu/" class="md-nav__link">
        Tpm menu
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../tpm_pin_mapping/" class="md-nav__link">
        Pin mapping
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../voyage_image_building_alix/" class="md-nav__link">
        Voyage image building alix
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../voyage_linux_netinst/" class="md-nav__link">
        Configuring Voyage Linux netinst
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../voyage_linux_sd_card_install/" class="md-nav__link">
        Voyage linux sd card install
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../power_consumption_testing/" class="md-nav__link">
        Power Consumption Testing
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_37" type="checkbox" id="__nav_37" checked>
      
      
      
        <label class="md-nav__link" for="__nav_37" tabindex="0" aria-expanded="true">
          debug
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="debug" data-md-level="1">
        <label class="md-nav__title" for="__nav_37">
          <span class="md-nav__icon md-icon"></span>
          debug
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../AGESA/" class="md-nav__link">
        AGESA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../alix3d2_issue/" class="md-nav__link">
        Alix3d2 issue
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cpu_frequency/" class="md-nav__link">
        Debug notes for CPU frequency issues
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../debian_kernel_rebuild/" class="md-nav__link">
        Debian kernel rebuild
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../external_sd_slot/" class="md-nav__link">
        External sd slot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../freeDOS_problems/" class="md-nav__link">
        freeDOS problems
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hdd_mPCIe_log_analyze/" class="md-nav__link">
        hdd mPCIe log analyze
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hdd_test/" class="md-nav__link">
        Hdd test
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../iommu/" class="md-nav__link">
        Iommu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mpcie_ethernet/" class="md-nav__link">
        Mpcie ethernet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mpcie1_mpcie2_ethernet_card/" class="md-nav__link">
        Mpcie1 mpcie2 ethernet card
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Mpcie2
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Mpcie2
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#rationale" class="md-nav__link">
    Rationale
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#symptoms" class="md-nav__link">
    Symptoms
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#carried-out-tests" class="md-nav__link">
    Carried out tests
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#possible-reasons" class="md-nav__link">
    Possible reasons
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../openwrt/" class="md-nav__link">
        Openwrt
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pfsense-ahci-issue/" class="md-nav__link">
        Pfsense ahci issue
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sd_registers_bad/" class="md-nav__link">
        Sd registers bad
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sdcard_debug/" class="md-nav__link">
        Sdcard debug
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sdcard_test/" class="md-nav__link">
        Sdcard test
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tplink_hg/" class="md-nav__link">
        Tplink hg
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tpm/" class="md-nav__link">
        Tpm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usb-debugging/" class="md-nav__link">
        apu2 USB xHCi debugging
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usb-sticks/" class="md-nav__link">
        Usb sticks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../usb-tests/" class="md-nav__link">
        Usb tests
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../warmboot_reset/" class="md-nav__link">
        Warmboot reset
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_38" type="checkbox" id="__nav_38" >
      
      
      
        <label class="md-nav__link" for="__nav_38" tabindex="0" aria-expanded="false">
          research
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="research" data-md-level="1">
        <label class="md-nav__title" for="__nav_38">
          <span class="md-nav__icon md-icon"></span>
          research
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research/apu_bios_write_protect/" class="md-nav__link">
        Apu bios write protect
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research/early-cbmem-implementation/" class="md-nav__link">
        Early cbmem implementation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research/fast_boot/" class="md-nav__link">
        Fast boot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research/freebsd_tpm_support/" class="md-nav__link">
        Freebsd tpm support
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research/geode_lx/" class="md-nav__link">
        Geode lx
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research/Orange_Pi_flasher/" class="md-nav__link">
        Orange Pi flasher
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research/power-consumption-tests/" class="md-nav__link">
        PC Engines apu3 power consumption tests
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research/ROCA/" class="md-nav__link">
        ROCA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research/RPI_SPI_flasher/" class="md-nav__link">
        RPI flasher
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research/tpm2-triage/" class="md-nav__link">
        Tpm2 triage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research/USB_compliance_test/" class="md-nav__link">
        USB compliance tests
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#rationale" class="md-nav__link">
    Rationale
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#symptoms" class="md-nav__link">
    Symptoms
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#carried-out-tests" class="md-nav__link">
    Carried out tests
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#possible-reasons" class="md-nav__link">
    Possible reasons
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="asm1061-in-the-j13-slot-problems">ASM1061 in the J13 slot problems</h1>
<h2 id="rationale">Rationale</h2>
<p>mPCIe 2 slot (J13) on APU2 devices has problems, when ASM1061 controllers are
used. With disk connected, device enters bootloop and never boots. When no disks
are connected, system boots normally and controller is detectable using <code>lspci</code>.</p>
<p>Another problem is, that normally ASM1061 contoller on the mPCIe board like,
e.g. this <a href="http://www.delock.de/produkte/F_428_Mini-PCI-Express_95233/merkmale.html">Delock adapter</a>, is not detectable in mPCIe 2 slot at all. One need
to modify the <code>apu2/romstage.c</code> file and enable always on Clock for GFX PCIE
slot, like this (in <code>cache_as_ram_main</code> function, after clock are set, see
<a href="https://github.com/pcengines/coreboot/blob/coreboot-4.5.x/src/mainboard/pcengines/apu2/romstage.c#L95">here</a>
for reference):</p>
<div class="highlight"><pre><span></span><code>        data = *((u32 *)(ACPI_MMIO_BASE + MISC_BASE + FCH_MISC_REG04));

        data &amp;= 0xFFFFFF0F;
        data |= 0xF &lt;&lt; (1 * 4); // CLKREQ GFX always on.

        *((u32 *)(ACPI_MMIO_BASE + MISC_BASE + FCH_MISC_REG04)) = data;
</code></pre></div>
<blockquote>
<p>See in <a href="http://support.amd.com/TechDocs/52740_16h_Models_30h-3Fh_BKDG.pdf">BKDG</a> paragraph 3.26.11: <code>MISCx04 ClkOutputCntrl</code> register</p>
</blockquote>
<h2 id="symptoms">Symptoms</h2>
<p>Currently after connecting disk - enters boot loop.</p>
<p>Problem occurs in SeaBIOS's AHCI driver. <code>ahci_port_detect</code> routine/thread.</p>
<p>AHCI reports <code>PORT_IRQ_IF_ERR</code> or <code>PORT_IRQ_IF_NONFATAL</code> errors:</p>
<blockquote>
<p>According to <a href="https://www.intel.com/content/www/us/en/io/serial-ata/serial-ata-ahci-spec-rev1-3-1.html">AHCI spec</a>, paragraph 3.3.5</p>
</blockquote>
<div class="highlight"><pre><span></span><code>|cff47000| AHCI/1: ... intbits 0x8000002, status 0x58 ..

... or ...

|cff47000| AHCI/1: ... intbits 0x40000001, status 0x51 ..
</code></pre></div>
<p>Reset happens just after setting transfer mode command is sent.
I've tried setting UDMA, MultiDMA or PIO modes and it's still the same (reset).</p>
<div class="highlight"><pre><span></span><code>|cff47000| AHCI/1: supported modes: udma 6, multi-dma 2, pio 4
|cff47000| AHCI/1: Set transfer mode to default PIO
|cff47000| AHCI/1: send cmd ...
|cff47000| AHCI/1: ... intbits 0x1, status 0x50, err 0x0 ...
|cff47000| AHCI/1: ... finished, status 0x50, OK

# reset happens always here
</code></pre></div>
<h2 id="carried-out-tests">Carried out tests</h2>
<p>Testing ASM1061 was performed for 2 types of Delock 95233 modules:
- module with soldered R58&sup1; resistor
- modified module without R58&sup1; resistor</p>
<p>(1) R58 resistor is placed next to CON1 connector</p>
<p>Test results are the same for both types of modules and as follows:</p>
<ol>
<li>
<p>Delock module is attached to mPCIe2 slot and SATA disk is connected before
    platform boot process.</p>
<p>In that case boot process went into 'infinite boot loop'. It went to payload
menu, hanged and after few seconds performed reboot automatically. During
booting, user can't do any action. There are no response from apu platform to
any button pressing. Only option to went through boot process without troubles
is to disconnect SATA disk and reboot platform again.</p>
</li>
<li>
<p>Delock module is attached to mPCIe2 slot, but no SATA disk is connected
    before and during platform boot process.</p>
<p>Boot process goes smoothly to seaBIOS menu and OS booting was performed
correctly also. Under Debian OS, ASM controller is detected (check it with
e.g. <code>dmesg | grep "ahci"</code>.</p>
<p><div class="highlight"><pre><span></span><code>root@debian:~# dmesg | grep &quot;ahci&quot;
[    9.370761] ahci 0000:00:11.0: version 3.0
[    9.371737] ahci 0000:00:11.0: AHCI 0001.0300 32 slots 2 ports 6 Gbps 0x3 impl SATA mode
[    9.380220] ahci 0000:00:11.0: flags: 64bit ncq sntf ilck pm led clo pmp fbs pio slum part ccc
[    9.389294] ahci 0000:00:11.0: both AHCI_HFLAG_MULTI_MSI flag set and custom irq handler implemented
[    9.401327] scsi host0: ahci
[    9.407101] scsi host1: ahci
[    9.432821] ahci 0000:01:00.0: SSS flag set, parallel bus scan disabled
[    9.564657] ahci 0000:01:00.0: AHCI 0001.0200 32 slots 2 ports 6 Gbps 0x3 impl SATA mode
[    9.572796] ahci 0000:01:00.0: flags: 64bit ncq sntf stag led clo pmp pio slum part ccc sxs
[    9.583302] scsi host2: ahci
[    9.586835] scsi host3: ahci
</code></pre></div>
Ahci 0000:01:00.0 is Dealock 95233 SATA controller.</p>
<p>After plugged-in SATA disk (no matter to what SATA port), configuration
problems appeared. Although, OS was trying to communicate with SATA, some
warnings and errors occurred. Example log is shown below.</p>
<div class="highlight"><pre><span></span><code>[   68.190693] ata3: exception Emask 0x10 SAct 0x0 SErr 0x4040000 action 0xe frozen
[   68.198142] ata3: irq_stat 0x00000040, connection status changed
[   68.204199] ata3: SError: { CommWake DevExch }
[   68.208743] ata3: hard resetting link
[   73.826743] ata3: SATA link up 3.0 Gbps (SStatus 123 SControl 300)
[   73.839192] ata3.00: ATA-8: ST500LM012 HN-M500MBB, 2AR10002, max UDMA/133
[   73.846011] ata3.00: 976773168 sectors, multi 0: LBA48 NCQ (depth 31/32), AA
[   73.859579] ata3.00: configured for UDMA/133
[   73.863903] ata3: EH complete
[   73.867515] scsi 2:0:0:0: Direct-Access     ATA      ST500LM012 HN-M5 0002 PQ: 0 ANSI: 5
[   73.876569] sd 2:0:0:0: Attached scsi generic sg1 type 0
[   73.876592] sd 2:0:0:0: [sdb] 976773168 512-byte logical blocks: (500 GB/466 GiB)
[   73.876597] sd 2:0:0:0: [sdb] 4096-byte physical blocks
[   73.876665] sd 2:0:0:0: [sdb] Write Protect is off
[   73.876827] sd 2:0:0:0: [sdb] Write cache: enabled, read cache: enabled, doesn&#39;t support DPO or FUA
[   73.941291]  sdb: sdb1 sdb2 &lt; sdb5 &gt;
[   73.946498] sd 2:0:0:0: [sdb] Attached SCSI disk
</code></pre></div>
</li>
</ol>
<p>Pay attention that some data is sent correctly between controller and OS (e.g.
HDD disk information or configuration). However, platform hanged in that stage
and didn't respond to any command. Therefore, faultless connection can't be
established and HDD disk plugged via Delock module can't be treated as working.</p>
<h2 id="possible-reasons">Possible reasons</h2>
<p>It looks like problem can be considered rather as hardware. Also it is Delock
95233 module/ASM1061 controller problem. Tested SATA disk works fine when
attached to SATA connector on apu2 board. After searching solutions, 2 main
appears as most useful:</p>
<ul>
<li>
<p>Power supply is not sufficient and drops out to too low level. However, tested
disk was powered with around 5V. Problems with power supply drop out occurred
in some  SATA disk, but mostly are related to 12V disks</p>
</li>
<li>
<p>Low quality cables and connectors on Delock module</p>
</li>
</ul>
<p>Both solutions haven't been tested yet. But it looks like they should be
considered and carried out.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.51d95adb.min.js"></script>
      
    
  </body>
</html>